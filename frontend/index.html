```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AskSunna | Islamic Knowledge Graph</title>
  <script src="https://unpkg.com/cytoscape@3.24.0/dist/cytoscape.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap">
  <style>
    :root {
      --bg-primary: #080821;
      --bg-secondary: #10102d;
      --surface-primary: rgba(16, 16, 45, 0.4);
      --surface-secondary: rgba(30, 30, 60, 0.3);
      --surface-tertiary: rgba(40, 40, 70, 0.2);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.8);
      --text-tertiary: rgba(255, 255, 255, 0.6);
      --accent-primary: #7b68ee;
      --accent-secondary: #00d4ff;
      --accent-tertiary: #ff6bcb;
      --accent-quaternary: #00d8c9;
      --accent-hover: #9e8cff;
      --border-light: rgba(255, 255, 255, 0.08);
      --shadow-soft: 0 8px 30px rgba(0, 0, 0, 0.7);
      --shadow-strong: 0 15px 40px rgba(0, 0, 0, 0.8);
      --blur-strong: blur(20px);
      --blur-light: blur(10px);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Outfit', -apple-system, system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      font-size: 16px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 0;
    }

    /* Background Gradients */
    .bg-gradient {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: -1;
      overflow: hidden;
    }

    .bg-gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
    }

    .bg-gradient-orb:nth-child(1) {
      background: linear-gradient(135deg, var(--accent-primary), transparent);
      width: 70vw;
      height: 70vw;
      top: -20vw;
      left: -20vw;
      opacity: 0.15;
      animation: float-slow 20s ease-in-out infinite alternate;
    }

    .bg-gradient-orb:nth-child(2) {
      background: linear-gradient(135deg, var(--accent-secondary), transparent);
      width: 60vw;
      height: 60vw;
      bottom: -30vw;
      right: -20vw;
      opacity: 0.1;
      animation: float-slow 25s ease-in-out infinite alternate-reverse;
    }

    .bg-gradient-orb:nth-child(3) {
      background: linear-gradient(135deg, var(--accent-tertiary), transparent);
      width: 40vw;
      height: 40vw;
      top: 40%;
      left: 60%;
      opacity: 0.07;
      animation: float-slow 30s ease-in-out infinite alternate;
    }

    @keyframes float-slow {
      0% { transform: translate(0, 0) rotate(0deg); }
      50% { transform: translate(-3%, 3%) rotate(5deg); }
      100% { transform: translate(3%, -3%) rotate(-5deg); }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    /* Logo and Header */
    .logo-container {
      display: flex;
      align-items: center;
      margin-bottom: 2.5rem;
      animation: fadeInDown 0.8s ease-out;
    }

    .logo {
      width: 60px;
      height: 60px;
      margin-right: 1rem;
      position: relative;
      border-radius: 16px;
      background: var(--surface-primary);
      backdrop-filter: var(--blur-strong);
      border: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .logo::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 16px;
      padding: 1.5px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      position: relative;
    }

    .logo-text {
      font-size: 2.4rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.03em;
      position: relative;
    }

    .logo-text span {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      width: 100%;
      max-width: 800px;
    }

    .subtitle {
      font-size: 1.1rem;
      color: var(--text-secondary);
      font-weight: 400;
      margin-top: 0.5rem;
      position: relative;
    }

    /* Search Container */
    .search-container {
      width: 100%;
      max-width: 800px;
      margin-bottom: 3rem;
      animation: fadeInUp 0.8s ease-out 0.2s both;
      position: relative;
    }

    .search-wrapper {
      position: relative;
      background: var(--surface-primary);
      border-radius: 24px;
      padding: 0.5rem;
      backdrop-filter: var(--blur-strong);
      -webkit-backdrop-filter: var(--blur-strong);
      transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      box-shadow: var(--shadow-soft);
      overflow: hidden;
    }

    .search-wrapper::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 24px;
      padding: 1.5px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .search-wrapper:hover {
      transform: translateY(-2px) scale(1.01);
      box-shadow: var(--shadow-strong);
    }

    .search-wrapper:hover::before {
      opacity: 1;
    }

    .search-wrapper::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(255,255,255,0.1) 0%, transparent 20%);
      opacity: 0;
      transition: opacity 0.3s;
      transform: scale(0.5);
      pointer-events: none;
    }

    .search-wrapper:hover::after {
      opacity: 0.05;
      transform: scale(1);
    }

    input[type="text"] {
      width: 100%;
      padding: 1.25rem 1.75rem;
      font-size: 1.25rem;
      border: none;
      background: transparent;
      color: var(--text-primary);
      outline: none;
      font-family: inherit;
    }

    input[type="text"]::placeholder {
      color: var(--text-tertiary);
    }

    .search-icon {
      position: absolute;
      right: 1.75rem;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      color: var(--accent-primary);
      opacity: 0.8;
      transition: all 0.3s;
    }

    .search-wrapper:hover .search-icon {
      opacity: 1;
      transform: translateY(-50%) scale(1.1);
    }

    /* Collection Filters */
    .collection-filters {
      display: flex;
      justify-content: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
    }

    .filter-chip {
      padding: 0.5rem 1.2rem;
      background: var(--surface-secondary);
      border-radius: 40px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid var(--border-light);
      backdrop-filter: var(--blur-light);
      -webkit-backdrop-filter: var(--blur-light);
      user-select: none;
    }

    .filter-chip:hover {
      background: var(--surface-tertiary);
      transform: translateY(-2px);
      color: var(--text-primary);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .filter-chip.active {
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      color: white;
      border: none;
      box-shadow: 0 5px 20px rgba(123, 104, 238, 0.3);
    }

    /* Graph Container */
    .graph-container {
      width: 100%;
      max-width: 1300px;
      animation: fadeInUp 0.8s ease-out 0.4s both;
      position: relative;
    }

    #cy {
      width: 100%;
      height: 750px;
      background: var(--surface-primary);
      border-radius: 32px;
      backdrop-filter: var(--blur-strong);
      -webkit-backdrop-filter: var(--blur-strong);
      box-shadow: var(--shadow-strong);
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
    }

    #cy::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 32px;
      padding: 1.5px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.5;
      pointer-events: none;
    }

    /* Loading State */
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: none;
      z-index: 10;
    }

    .loading.active {
      display: block;
    }

    .loading-spinner {
      position: relative;
      width: 80px;
      height: 80px;
    }

    .loading-spinner .circle {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      opacity: 0.7;
    }

    .loading-spinner .circle:nth-child(1) {
      border: 4px solid transparent;
      border-top-color: var(--accent-primary);
      animation: spin 1s linear infinite;
    }

    .loading-spinner .circle:nth-child(2) {
      border: 4px solid transparent;
      border-right-color: var(--accent-secondary);
      animation: spin 1s linear infinite reverse;
      width: 80%;
      height: 80%;
      top: 10%;
      left: 10%;
    }

    .loading-spinner .circle:nth-child(3) {
      border: 4px solid transparent;
      border-bottom-color: var(--accent-tertiary);
      animation: spin 1s linear infinite;
      width: 60%;
      height: 60%;
      top: 20%;
      left: 20%;
    }

    .loading-text {
      position: absolute;
      width: 100%;
      text-align: center;
      bottom: -40px;
      font-size: 1rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Floating Action Buttons */
    .fab-container {
      position: absolute;
      right: 2rem;
      bottom: 2rem;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 1rem;
      z-index: 50;
    }

    .fab {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--surface-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      transition: all 0.3s;
      backdrop-filter: var(--blur-strong);
      -webkit-backdrop-filter: var(--blur-strong);
      position: relative;
      overflow: hidden;
    }

    .fab::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 50%;
      padding: 1.5px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }

    .fab:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: var(--shadow-strong);
    }

    .fab svg {
      width: 24px;
      height: 24px;
      color: var(--text-primary);
    }

    /* Tooltip */
    .tooltip {
      position: absolute;
      background: var(--surface-primary);
      color: var(--text-primary);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      font-size: 0.875rem;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      backdrop-filter: var(--blur-strong);
      -webkit-backdrop-filter: var(--blur-strong);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-soft);
      z-index: 1000;
      max-width: 300px;
      line-height: 1.6;
      transform: translateY(10px);
    }

    .tooltip.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .tooltip::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 12px;
      padding: 1px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }

    /* Summary Panel */
    .summary-panel {
      position: fixed;
      left: 2rem;
      bottom: -400px;
      width: 380px;
      background: var(--surface-primary);
      border-radius: 24px;
      padding: 1.5rem;
      backdrop-filter: var(--blur-strong);
      -webkit-backdrop-filter: var(--blur-strong);
      box-shadow: var(--shadow-strong);
      transition: bottom 0.5s cubic-bezier(0.16, 1, 0.3, 1);
      z-index: 100;
    }

    .summary-panel.active {
      bottom: 2rem;
    }

    .summary-panel::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 24px;
      padding: 1.5px;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }

    .summary-panel h3 {
      font-size: 1.3rem;
      margin-bottom: 1rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .summary-panel h3 svg {
      width: 20px;
      height: 20px;
      color: var(--accent-primary);
    }

    .summary-content {
      font-size: 0.95rem;
      line-height: 1.7;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .summary-content::-webkit-scrollbar {
      width: 4px;
    }

    .summary-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    .summary-content::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 10px;
    }

    .summary-footer {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-tertiary);
      padding-top: 0.5rem;
      border-top: 1px solid var(--border-light);
    }

    .summary-sources {
      cursor: pointer;
      transition: color 0.2s;
    }

    .summary-sources:hover {
      color: var(--accent-primary);
    }

    /* Detail Panel */
    .detail-panel {
      position: fixed;
      right: -450px;
      top: 0;
      width: 450px;
      height: 100vh;
      background: rgba(8, 8, 33, 0.97);
      backdrop-filter: var(--blur-strong);
      -webkit-backdrop-filter: var(--blur-strong);
      border-left: 1px solid var(--border-light);
      padding: 2.5rem;
      transition: right 0.5s cubic-bezier(0.16, 1, 0.3, 1);
      overflow-y: auto;
      z-index: 100;
    }

    .detail-panel.active {
      right: 0;
      box-shadow: -10px 0 40px rgba(0, 0, 0, 0.5);
    }

    .detail-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 1px;
      height: 100%;
      background: linear-gradient(to bottom,
        transparent,
        var(--accent-primary),
        var(--accent-secondary),
        var(--accent-tertiary),
        transparent);
    }

    .detail-panel h2 {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: inline-block;
    }

    .detail-panel .close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      color: var(--text-secondary);
    }

    .detail-panel .close:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.1) rotate(90deg);
      color: var(--text-primary);
    }

    .detail-content {
      color: var(--text-secondary);
      line-height: 1.8;
      font-size: 1.05rem;
      margin-bottom: 2rem;
    }

    .detail-arabic {
      font-family: 'Traditional Arabic', serif;
      font-size: 1.6rem;
      line-height: 2;
      text-align: right;
      margin: 2rem 0;
      color: var(--text-primary);
      direction: rtl;
    }

    .detail-meta {
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border-light);
    }

    .meta-item {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 0;
      font-size: 0.925rem;
    }

    .meta-item:not(:last-child) {
      border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
    }

    .meta-label {
      color: var(--text-tertiary);
      font-weight: 500;
    }

    .meta-links {
      margin-top: 2rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .meta-link {
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      background: var(--surface-secondary);
      border-radius: 8px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s;
    }

    .meta-link:hover {
      background: var(--accent-primary);
      color: white;
      transform: translateY(-3px);
    }

    /* Animations */
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .logo-text {
        font-size: 2rem;
      }

      .subtitle {
        font-size: 1rem;
      }

      .search-container {
        max-width: 100%;
      }

      #cy {
        height: 600px;
      }

      .detail-panel {
        width: 100%;
        right: -100%;
      }

      .summary-panel {
        width: calc(100% - 4rem);
        left: 2rem;
      }
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>
  <div class="bg-gradient">
    <div class="bg-gradient-orb"></div>
    <div class="bg-gradient-orb"></div>
    <div class="bg-gradient-orb"></div>
  </div>

  <div class="container">
    <div class="logo-container">
      <div class="logo">
        <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L3 6V14C3 17.3137 7.02944 20 12 20C16.9706 20 21 17.3137 21 14V6L12 2Z" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 7V13" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="16" r="1" fill="url(#gradient)"/>
          <defs>
            <linearGradient id="gradient" x1="3" y1="2" x2="21" y2="20" gradientUnits="userSpaceOnUse">
              <stop stop-color="#7B68EE"/>
              <stop offset="1" stop-color="#00D4FF"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <h1 class="logo-text">Ask<span>Sunna</span></h1>
    </div>

    <div class="header">
      <p class="subtitle">Исследуйте все коллекции Сунны с помощью передовых технологий искусственного интеллекта</p>
    </div>

    <div class="search-container">
      <div class="search-wrapper">
        <input type="text" id="query" placeholder="Какие хадисы говорят о намерении в делах?" />
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
      </div>

      <div class="collection-filters">
        <div class="filter-chip active" data-collection="all">Все источники</div>
        <div class="filter-chip" data-collection="bukhari">Сахих аль-Бухари</div>
        <div class="filter-chip" data-collection="muslim">Сахих Муслим</div>
        <div class="filter-chip" data-collection="tirmidhi">Джами ат-Тирмизи</div>
        <div class="filter-chip" data-collection="abudawud">Сунан Абу Дауд</div>
        <div class="filter-chip" data-collection="nasai">Сунан ан-Насаи</div>
        <div class="filter-chip" data-collection="ibnmajah">Сунан Ибн Маджах</div>
      </div>
    </div>

    <div class="graph-container">
      <div id="cy">
        <div class="loading" id="loading">
          <div class="loading-spinner">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
          </div>
          <div class="loading-text">Анализируем источники...</div>
        </div>
      </div>

      <div class="fab-container">
        <div class="fab" id="zoomIn" title="Приблизить">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="8" x2="12" y2="16"/>
            <line x1="8" y1="12" x2="16" y2="12"/>
          </svg>
        </div>
        <div class="fab" id="zoomOut" title="Отдалить">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <line x1="8" y1="12" x2="16" y2="12"/>
          </svg>
        </div>
        <div class="fab" id="resetView" title="Сбросить вид">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 12a9 9 0 1 0 18 0 9 9 0 0 0-18 0z"/>
            <path d="M17 12H7"/>
            <path d="M12 17V7"/>
          </svg>
        </div>
        <div class="fab" id="downloadGraph" title="Скачать граф">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <div class="summary-panel" id="summaryPanel">
    <h3>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
      </svg>
      Обобщённый ответ
    </h3>
    <div class="summary-content" id="summaryContent">
      Получение данных...
    </div>
    <div class="summary-footer">
      <div>На основе <span id="sourceCount">0</span> источников</div>
      <div class="summary-sources">Показать все источники</div>
    </div>
  </div>

  <div class="detail-panel" id="detailPanel">
    <div class="close" onclick="closeDetail()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 6L6 18M6 6l12 12"/>
      </svg>
    </div>
    <h2 id="detailTitle">Детали хадиса</h2>
    <div class="detail-content" id="detailContent"></div>
    <div class="detail-arabic" id="detailArabic"></div>
    <div class="detail-meta" id="detailMeta"></div>
    <div class="meta-links" id="detailLinks"></div>
  </div>

  <div class="tooltip" id="tooltip"></div>

  <script>
    let cy;
    let tooltip = document.getElementById('tooltip');
    let currentLayout;
    let activeFilters = ['all'];

    // Enhanced graph styles with more modern, futuristic look
    const graphStyles = [
      {
        selector: 'node',
        style: {
          'background-color': '#1a1a3a',
          'background-opacity': 0.8,
          'label': 'data(label)',
          'color': '#f0f0f0',
          'text-valign': 'center',
          'text-halign': 'center',
          'text-wrap': 'wrap',
          'text-max-width': '240px',
          'font-size': '14px',
          'font-weight': '400',
          'padding': '20px',
          'border-width': 1,
          'border-color': '#333366',
          'border-opacity': 0.6,
          'shape': 'roundrectangle',
          'width': 'label',
          'height': 'label',
          'overlay-padding': '8px',
          'transition-property': 'background-color, border-color, border-width, box-shadow',
          'transition-duration': '0.4s',
          'transition-timing-function': 'cubic-bezier(0.2, 0.8, 0.2, 1)',
          'text-outline-color': '#1a1a3a',
          'text-outline-width': 2,
          'text-outline-opacity': 0.9,
          'shadow-blur': 5,
          'shadow-color': '#000',
          'shadow-opacity': 0.3,
          'shadow-offset-x': 0,
          'shadow-offset-y': 2
        }
      },
      {
        selector: 'node[type="summary"]',
        style: {
          'background-color': '#7b68ee',
          'background-opacity': 0.2,
          'border-color': '#7b68ee',
          'border-width': 2,
          'font-size': '18px',
          'font-weight': '600',
          'text-max-width': '280px',
          'shape': 'round-rectangle',
          'padding': '25px',
          'shadow-blur': 10,
          'shadow-color': '#7b68ee',
          'shadow-opacity': 0.3,
          'shadow-offset-x': 0,
          'shadow-offset-y': 5
        }
      },
      {
        selector: 'node[type="collection"]',
        style: {
          'background-color': '#2a2a4a',
          'border-color': '#00d4ff',
          'border-width': 2,
          'font-size': '16px',
          'font-weight': '500',
          'shape': 'round-diamond'
        }
      },
      {
        selector: 'node[collection="bukhari"]',
        style: {
          'border-color': '#00d8c9'
        }
      },
      {
        selector: 'node[collection="muslim"]',
        style: {
          'border-color': '#00d4ff'
        }
      },
      {
        selector: 'node[collection="tirmidhi"]',
        style: {
          'border-color': '#ff6bcb'
        }
      },
      {
        selector: 'node[collection="abudawud"]',
        style: {
          'border-color': '#ffb347'
        }
      },
      {
        selector: 'node[type="narrator"]',
        style: {
          'background-color': '#20202a',
          'border-color': '#ff6bcb',
          'border-width': 1.5,
          'font-size': '12px',
          'shape': 'ellipse',
          'width': 120,
          'height': 40
        }
      },
      {
        selector: 'node:hover',
        style: {
          'background-color': '#3a3a5a',
          'border-color': '#7b68ee',
          'border-width': 2.5,
          'z-index': 999,
          'shadow-blur': 15,
          'shadow-color': '#7b68ee',
          'shadow-opacity': 0.5,
          'shadow-offset-x': 0,
          'shadow-offset-y': 5,
          'transition-property': 'background-color, border-color, border-width, shadow-blur, shadow-opacity, shadow-offset-y',
          'transition-duration': '0.3s'
        }
      },
      {
        selector: 'node:selected',
        style: {
          'background-color': '#7b68ee',
          'background-opacity': 0.2,
          'border-color': '#7b68ee',
          'border-width': 3,
          'shadow-blur': 20,
          'shadow-color': '#7b68ee',
          'shadow-opacity': 0.6,
          'shadow-offset-y': 5
        }
      },
      {
        selector: 'edge',
        style: {
          'width': 2,
          'line-color': 'data(color)',
          'target-arrow-color': 'data(color)',
          'target-arrow-shape': 'triangle',
          'curve-style': 'unbundled-bezier',
          'control-point-distances': [40],
          'control-point-weights': [0.5],
          'opacity': 0.6,
          'transition-property': 'line-color, width, opacity',
          'transition-duration': '0.3s',
          'edge-distances': 'node-position',
          'arrow-scale': 0.8,
          'z-index': 0
        }
      },
      {
        selector: 'edge[type="narrator"]',
        style: {
          'line-style': 'dashed',
          'line-dash-pattern': [6, 3],
          'opacity': 0.4
        }
      },
      {
        selector: 'edge:hover',
        style: {
          'width': 3,
          'opacity': 1,
          'z-index': 9
        }
      }
    ];

    // Initialize particles.js
    function initParticles() {
      particlesJS('particles-js', {
        "particles": {
          "number": {
            "value": 80,
            "density": {
              "enable": true,
              "value_area": 800
            }
          },
          "color": {
            "value": "#ffffff"
          },
          "shape": {
            "type": "circle",
            "stroke": {
              "width": 0,
              "color": "#000000"
            },
            "polygon": {
              "nb_sides": 5
            }
          },
          "opacity": {
            "value": 0.15,
            "random": true,
            "anim": {
              "enable": true,
              "speed": 0.2,
              "opacity_min": 0.05,
              "sync": false
            }
          },
          "size": {
            "value": 3,
            "random": true,
            "anim": {
              "enable": true,
              "speed": 2,
              "size_min": 0.1,
              "sync": false
            }
          },
          "line_linked": {
            "enable": true,
            "distance": 150,
            "color": "#ffffff",
            "opacity": 0.06,
            "width": 1
          },
          "move": {
            "enable": true,
            "speed": 0.4,
            "direction": "none",
            "random": true,
            "straight": false,
            "out_mode": "out",
            "bounce": false,
            "attract": {
              "enable": true,
              "rotateX": 600,
              "rotateY": 1200
            }
          }
        },
        "interactivity": {
          "detect_on": "canvas",
          "events": {
            "onhover": {
              "enable": true,
              "mode": "grab"
            },
            "onclick": {
              "enable": true,
              "mode": "push"
            },
            "resize": true
          },
          "modes": {
            "grab": {
              "distance": 140,
              "line_linked": {
                "opacity": 0.3
              }
            },
            "bubble": {
              "distance": 400,
              "size": 40,
              "duration": 2,
              "opacity": 8,
              "speed": 3
            },
            "repulse": {
              "distance": 200,
              "duration": 0.4
            },
            "push": {
              "particles_nb": 4
            },
            "remove": {
              "particles_nb": 2
            }
          }
        },
        "retina_detect": true
      });
    }

    function initGraph() {
      cy = cytoscape({
        container: document.getElementById('cy'),
        style: graphStyles,
        minZoom: 0.2,
        maxZoom: 3,
        wheelSensitivity: 0.2,
        pixelRatio: 'auto'
      });

      // Mouse events
      cy.on('mouseover', 'node', function(evt) {
        let node = evt.target;
        tooltip.innerHTML = node.data('tooltip') || node.data('label');
        tooltip.style.left = evt.originalEvent.clientX + 10 + 'px';
        tooltip.style.top = evt.originalEvent.clientY + 10 + 'px';
        tooltip.classList.add('visible');
      });

      cy.on('mouseout', 'node', function() {
        tooltip.classList.remove('visible');
      });

      cy.on('mousemove', function(evt) {
        if (tooltip.classList.contains('visible')) {
          tooltip.style.left = evt.originalEvent.clientX + 10 + 'px';
          tooltip.style.top = evt.originalEvent.clientY + 10 + 'px';
        }
      });

      cy.on('tap', 'node', function(evt) {
        showDetail(evt.target.data());
      });

      // FAB button events
      document.getElementById('zoomIn').addEventListener('click', function() {
        cy.animate({
          zoom: cy.zoom() * 1.2,
          duration: 300
        });
      });

      document.getElementById('zoomOut').addEventListener('click', function() {
        cy.animate({
          zoom: cy.zoom() * 0.8,
          duration: 300
        });
      });

      document.getElementById('resetView').addEventListener('click', function() {
        cy.fit(undefined, 50);
        cy.center();
      });

      document.getElementById('downloadGraph').addEventListener('click', function() {
        const png64 = cy.png({scale: 2, full: true, bg: '#080821'});
        const link = document.createElement('a');
        link.download = 'asksunna-graph.png';
        link.href = png64;
        link.click();
      });

      // Collection filter events
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.addEventListener('click', function() {
          const collection = this.getAttribute('data-collection');

          if (collection === 'all') {
            activeFilters = ['all'];
            document.querySelectorAll('.filter-chip').forEach(c => {
              c.classList.toggle('active', c.getAttribute('data-collection') === 'all');
            });
          } else {
            // Remove 'all' from filters if it's there
            const allIndex = activeFilters.indexOf('all');
            if (allIndex > -1) {
              activeFilters.splice(allIndex, 1);
              document.querySelector('.filter-chip[data-collection="all"]').classList.remove('active');
            }

            // Toggle the selected filter
            const index = activeFilters.indexOf(collection);
            if (index > -1) {
              activeFilters.splice(index, 1);
              this.classList.remove('active');
            } else {
              activeFilters.push(collection);
              this.classList.add('active');
            }

            // If no filters are selected, select 'all'
            if (activeFilters.length === 0) {
              activeFilters = ['all'];
              document.querySelector('.filter-chip[data-collection="all"]').classList.add('active');
            }
          }

          applyFilters();
        });
      });

      // Initial demo data
      renderDemoGraph();
    }

    function applyFilters() {
      if (activeFilters.includes('all')) {
        cy.elements().removeClass('filtered');
      } else {
        // First, mark all nodes as filtered
        cy.elements().addClass('filtered');

        // Then, remove the filtered class from nodes that match the active filters
        activeFilters.forEach(filter => {
          cy.nodes(`[collection="${filter}"]`).removeClass('filtered');
          // Also include connected nodes and edges
          cy.nodes(`[collection="${filter}"]`).neighborhood().removeClass('filtered');
          // Always include summary node
          cy.nodes('[type="summary"]').removeClass('filtered');
        });
      }

      // Apply visual styling based on filtered state
      cy.style()
        .selector('.filtered')
        .style({
          'opacity': 0.25,
          'z-index': 0
        })
        .update();
    }

    function renderDemoGraph() {
      document.getElementById('loading').classList.add('active');

      setTimeout(() => {
        const elements = generateInitialGraph();
        cy.add(elements);
        runLayout();

        setTimeout(() => {
          document.getElementById('loading').classList.remove('active');
          document.getElementById('summaryPanel').classList.add('active');
          document.getElementById('sourceCount').textContent = cy.nodes('[type="hadith"]').length;
        }, 500);
      }, 1000);
    }

    function searchHadith() {
      const query = document.getElementById('query').value || 'Какие хадисы говорят о намерении?';

      // Hide summary panel
      document.getElementById('summaryPanel').classList.remove('active');

      // Show loading
      document.getElementById('loading').classList.add('active');

      // Clear current graph
      cy.elements().remove();

      // Simulate API call
      setTimeout(() => {
        const elements = generateSearchGraph(query);
        cy.add(elements);
        runLayout();

        setTimeout(() => {
          document.getElementById('loading').classList.remove('active');
          document.getElementById('summaryPanel').classList.add('active');
          document.getElementById('summaryContent').innerHTML = generateSummary(query);
          document.getElementById('sourceCount').textContent = cy.nodes('[type="hadith"]').length;
        }, 500);
      }, 1500);
    }

    function generateInitialGraph() {
      return [
        {
          data: {
            id: 'summary',
            label: 'Намерение является основой для оценки деяний в исламе',
            type: 'summary',
            tooltip: 'Обобщённый ответ на основе всех источников'
          }
        },
        {
          data: {
            id: 'bukhari',
            label: 'Сахих аль-Бухари',
            type: 'collection',
            collection: 'bukhari',
            tooltip: 'Один из шести основных суннитских сборников хадисов'
          }
        },
        {
          data: {
            id: 'muslim',
            label: 'Сахих Муслим',
            type: 'collection',
            collection: 'muslim',
            tooltip: 'Сборник достоверных хадисов, составленный имамом Муслимом'
          }
        },
        {
          data: {
            id: 'h1',
            label: 'Поистине, дела оцениваются по намерениям...',
            type: 'hadith',
            collection: 'bukhari',
            tooltip: 'Сахих аль-Бухари, Книга 1, Хадис 1',
            fullText: 'Поистине, дела оцениваются по намерениям, и каждому человеку достанется лишь то, что он намеревался обрести. Так, переселившийся ради Аллаха и посланника Его переселится к Аллаху и посланнику Его, а переселявшийся ради мирских благ или ради женщины, на которой он хотел жениться, переселится к тому, к чему он переселялся.',
            arabicText: 'إِنَّمَا الأَعْمَالُ بِالنِّيَّاتِ، وَإِنَّمَا لِكُلِّ امْرِئٍ مَا نَوَى، فَمَنْ كَانَتْ هِجْرَتُهُ إِلَى اللَّهِ وَرَسُولِهِ، فَهِجْرَتُهُ إِلَى اللَّهِ وَرَسُولِهِ، وَمَنْ كَانَتْ هِجْرَتُهُ لِدُنْيَا يُصِيبُهَا أَوْ امْرَأَةٍ يَنْكِحُهَا، فَهِجْرَتُهُ إِلَى مَا هَاجَرَ إِلَيْهِ',
            narrator: 'Умар ибн аль-Хаттаб',
            book: 'Книга 1: Начало откровения',
            number: '1',
            grade: 'Сахих (достоверный)'
          }
        },
        {
          data: {
            id: 'h2',
            label: 'Тот, кто совершит хиджру ради Аллаха и Его Посланника...',
            type: 'hadith',
            collection: 'muslim',
            tooltip: 'Сахих Муслим, Книга 20, Хадис 4927',
            fullText: 'Тот, кто совершит хиджру ради Аллаха и Его Посланника, его хиджра будет засчитана как ради Аллаха и Его Посланника. А кто совершит хиджру ради мирских благ или ради женщины, на которой хочет жениться, его хиджра будет засчитана как то, ради чего он ее совершил.',
            arabicText: 'مَنْ كَانَتْ هِجْرَتُهُ إِلَى اللَّهِ وَرَسُولِهِ فَهِجْرَتُهُ إِلَى اللَّهِ وَرَسُولِهِ وَمَنْ كَانَتْ هِجْرَتُهُ لِدُنْيَا يُصِيبُهَا أَوْ امْرَأَةٍ يَتَزَوَّجُهَا فَهِجْرَتُهُ إِلَى مَا هَاجَرَ إِلَيْهِ',
            narrator: 'Умар ибн аль-Хаттаб',
            book: 'Книга 20: О правлении',
            number: '4927',
            grade: 'Сахих (достоверный)'
          }
        },
        {
          data: {
            id: 'h3',
            label: 'Награда за дела зависит от намерений',
            type: 'hadith',
            collection: 'bukhari',
            tooltip: 'Сахих аль-Бухари, Книга 54, Хадис 423',
            fullText: 'Награда за дела зависит от намерений, и каждый человек получит то, что он намеревался получить. Тот, кто эмигрировал ради Аллаха и Его Посланника, его эмиграция будет ради Аллаха и Его Посланника; а тот, кто эмигрировал ради мирских благ или чтобы жениться на женщине, его эмиграция будет для того, ради чего он эмигрировал.',
            arabicText: 'إِنَّمَا الأَعْمَالُ بِالنِّيَّةِ وَإِنَّمَا لِامْرِئٍ مَا نَوَى فَمَنْ كَانَتْ هِجْرَتُهُ إِلَى اللَّهِ وَرَسُولِهِ فَهِجْرَتُهُ إِلَى اللَّهِ وَرَسُولِهِ وَمَنْ كَانَتْ هِجْرَتُهُ لِدُنْيَا يُصِيبُهَا أَوِ امْرَأَةٍ يَنْكِحُهَا فَهِجْرَتُهُ إِلَى مَا هَاجَرَ إِلَيْهِ',
            narrator: 'Умар ибн аль-Хаттаб',
            book: 'Книга 54: Начало творения',
            number: '423',
            grade: 'Сахих (достоверный)'
          }
        },
        {
          data: {
            id: 'n1',
            label: 'Умар ибн аль-Хаттаб',
            type: 'narrator',
            tooltip: 'Второй праведный халиф, один из ближайших сподвижников Пророка Мухаммада'
          }
        },

        // Edges with colors based on connection type
        { data: { source: 'summary', target: 'bukhari', color: '#7b68ee' } },
        { data: { source: 'summary', target: 'muslim', color: '#7b68ee' } },
        { data: { source: 'bukhari', target: 'h1', color: '#00d8c9' } },
        { data: { source: 'bukhari', target: 'h3', color: '#00d8c9' } },
        { data: { source: 'muslim', target: 'h2', color: '#00d4ff' } },
        { data: { source: 'h1', target: 'n1', type: 'narrator', color: '#ff6bcb' } },
        { data: { source: 'h2', target: 'n1', type: 'narrator', color: '#ff6bcb' } },
        { data: { source: 'h3', target: 'n1', type: 'narrator', color: '#ff6bcb' } },
        { data: { source: 'h1', target: 'h2', color: 'rgba(255,255,255,0.3)' } },
        { data: { source: 'h1', target: 'h3', color: 'rgba(255,255,255,0.3)' } }
      ];
    }

    function generateSearchGraph(query) {
      // Collections
      const collections = [
        { id: 'bukhari', label: 'Сахих аль-Бухари', color: '#00d8c9' },
        { id: 'muslim', label: 'Сахих Муслим', color: '#00d4ff' },
        { id: 'tirmidhi', label: 'Джами ат-Тирмизи', color: '#ff6bcb' },
        { id: 'abudawud', label: 'Сунан Абу Дауд', color: '#ffb347' },
        { id: 'nasai', label: 'Сунан ан-Насаи', color: '#c89bf7' },
        { id: 'ibnmajah', label: 'Сунан Ибн Маджах', color: '#38b2ac' }
      ];

      // Random selection of 3-5 collections for this query
      const selectedCollections = collections
        .sort(() => 0.5 - Math.random())
        .slice(0, Math.floor(Math.random() * 3) + 3);

      // Generate elements array
      const elements = [
        {
          data: {
            id: 'summary',
            label: generateSummaryTitle(query),
            type: 'summary',
            tooltip: 'Обобщённый ответ на основе всех источников'
          }
        }
      ];

      // Add collection nodes
      selectedCollections.forEach(collection => {
        elements.push({
          data: {
            id: collection.id,
            label: collection.label,
            type: 'collection',
            collection: collection.id,
            tooltip: `Коллекция хадисов: ${collection.label}`
          }
        });

        // Connect summary to collection
        elements.push({
          data: {
            source: 'summary',
            target: collection.id,
            color: '#7b68ee'
          }
        });
      });

      // Generate hadiths for each collection
      const narrators = [
        'Умар ибн аль-Хаттаб',
        'Абу Хурайра',
        'Аиша',
        'Анас ибн Малик',
        'Абдуллах ибн Аббас',
        'Абдуллах ибн Умар',
        'Абу Саид аль-Худри'
      ];

      const narratorNodes = {};
      let hadithCount = 1;

      selectedCollections.forEach(collection => {
        // Random number of hadiths per collection (1-3)
        const numHadiths = Math.floor(Math.random() * 3) + 1;

        for (let i = 0; i < numHadiths; i++) {
          const hadithId = `h${hadithCount++}`;
          const narrator = narrators[Math.floor(Math.random() * narrators.length)];
          const narratorId = `n_${narrator.replace(/\s+/g, '_')}`;

          // Add hadith node
          elements.push({
            data: {
              id: hadithId,
              label: generateHadithText(query, collection.id).substring(0, 120) + '...',
              type: 'hadith',
              collection: collection.id,
              tooltip: `${collection.label}, Хадис ${Math.floor(Math.random() * 5000) + 1}`,
              fullText: generateHadithText(query, collection.id),
              arabicText: 'إِنَّمَا الأَعْمَالُ بِالنِّيَّاتِ، وَإِنَّمَا لِكُلِّ امْرِئٍ مَا نَوَى',
              narrator: narrator,
              book: `Книга ${Math.floor(Math.random() * 80) + 1}`,
              number: `${Math.floor(Math.random() * 5000) + 1}`,
              grade: ['Сахих (достоверный)', 'Хасан (хороший)', 'Даиф (слабый)'][Math.floor(Math.random() * 3)]
            }
          });

          // Connect collection to hadith
          elements.push({
            data: {
              source: collection.id,
              target: hadithId,
              color: collection.color
            }
          });

          // Add narrator if not already added
          if (!narratorNodes[narratorId]) {
            elements.push({
              data: {
                id: narratorId,
                label: narrator,
                type: 'narrator',
                tooltip: `Рассказчик: ${narrator}`
              }
            });
            narratorNodes[narratorId] = true;
          }

          // Connect hadith to narrator
          elements.push({
            data: {
              source: hadithId,
              target: narratorId,
              type: 'narrator',
              color: '#ff6bcb'
            }
          });
        }
      });

      // Add some connections between hadiths
      const hadiths = elements.filter(el => el.data.type === 'hadith');
      for (let i = 0; i < hadiths.length; i++) {
        for (let j = i + 1; j < hadiths.length; j++) {
          if (Math.random() > 0.7) {
            elements.push({
              data: {
                source: hadiths[i].data.id,
                target: hadiths[j].data.id,
                color: 'rgba(255,255,255,0.3)'
              }
            });
          }
        }
      }

      return elements;
    }

    function generateSummaryTitle(query) {
      // Sample titles based on common questions
      if (query.toLowerCase().includes('намерени')) {
        return 'Намерение является основой для оценки деяний в исламе';
      } else if (query.toLowerCase().includes('молитв') || query.toLowerCase().includes('намаз')) {
        return 'Молитва - второй столп ислама и ключ к успеху';
      } else if (query.toLowerCase().includes('пост') || query.toLowerCase().includes('рамадан')) {
        return 'Пост в месяц Рамадан обязателен для всех мусульман';
      } else if (query.toLowerCase().includes('закят') || query.toLowerCase().includes('милостын')) {
        return 'Закят - обязательная благотворительность в исламе';
      } else if (query.toLowerCase().includes('хадж')) {
        return 'Хадж - обязательное паломничество для способных мусульман';
      } else {
        return 'Обобщённый ответ на ваш запрос';
      }
    }

    function generateHadithText(query, collection) {
      // Sample texts based on collections and queries
      if (query.toLowerCase().includes('намерени')) {
        const texts = [
          'Поистине, дела оцениваются по намерениям, и каждому человеку достанется лишь то, что он намеревался обрести...',
          'Тот, кто совершит деяние с правильным намерением, получит награду от Аллаха соответственно своему намерению...',
          'Награда за дела зависит от намерений, и каждый человек получит то, что он намеревался получить...',
          'Аллах смотрит не на ваши тела и внешность, а на ваши сердца и намерения...'
        ];
        return texts[Math.floor(Math.random() * texts.length)];
      } else if (query.toLowerCase().includes('молитв') || query.toLowerCase().includes('намаз')) {
        const texts = [
          'Молитва является опорой религии. Кто совершает её, тот возводит религию, а кто оставляет её, тот разрушает религию...',
          'Ключ к Раю - молитва, а ключ к молитве - омовение...',
          'Пророк (мир ему) сказал: "Совершайте молитву так, как вы видели меня совершающим её"...',
          'Первое, о чём будет спрошен раб Аллаха в День Суда, это молитва. Если она будет принята, то будут приняты и все остальные дела...'
        ];
        return texts[Math.floor(Math.random() * texts.length)];
      } else {
        const texts = [
          'Передается от Пророка (мир ему), что он сказал: "Лучшим из вас является тот, кто изучает Коран и обучает ему других"...',
          'Аллах облегчит путь в Рай тому, кто облегчает путь в поисках знаний...',
          'Тот, кто указал на благое дело, получит такую же награду, как и совершивший его...',
          'Кто бы ни вступил на путь поиска знаний, Аллах облегчит ему путь в Рай...'
        ];
        return texts[Math.floor(Math.random() * texts.length)];
      }
    }

    function generateSummary(query) {
      if (query.toLowerCase().includes('намерени')) {
        return `<p>Согласно хадисам из различных достоверных источников, намерение (<em>ният</em>) является фундаментальным аспектом в исламе и имеет решающее значение для оценки деяний человека.</p>
        <p>Основополагающим хадисом на эту тему является высказывание Пророка Мухаммада (мир ему), переданное Умаром ибн аль-Хаттабом: <em>"Поистине, дела оцениваются по намерениям, и каждому человеку достанется лишь то, что он намеревался обрести"</em>.</p>
        <p>Этот хадис подчеркивает, что Аллах смотрит не только на внешние действия человека, но и на его внутренние намерения. Ценность и достоинство деяния определяется искренностью намерения человека и его стремлением угодить Аллаху.</p>`;
      } else if (query.toLowerCase().includes('молитв') || query.toLowerCase().includes('намаз')) {
        return `<p>Молитва (намаз) является вторым столпом ислама и обязательна для каждого мусульманина. Хадисы подчеркивают фундаментальную важность молитвы в религиозной практике.</p>
        <p>Пророк Мухаммад (мир ему) сказал: <em>"Молитва является опорой религии. Кто совершает её, тот возводит религию, а кто оставляет её, тот разрушает религию"</em>.</p>
        <p>Также в достоверных хадисах сообщается, что первое, о чём будет спрошен человек в День Суда, это молитва. Если она будет принята, то будут приняты и все остальные дела.</p>`;
      } else {
        return `<p>Ваш запрос охватывает несколько аспектов исламского учения, которые освещены в различных хадисах.</p>
        <p>Согласно достоверным источникам, Пророк Мухаммад (мир ему) наставлял своих последователей придерживаться праведного пути и стремиться к знаниям.</p>
        <p>В хадисах особое внимание уделяется важности искренности намерений, постоянства в поклонении и доброго отношения к окружающим. Ислам подчеркивает, что все деяния оцениваются не только по внешнему проявлению, но и по внутренним намерениям человека.</p>`;
      }
    }

    function runLayout() {
      if (currentLayout) {
        currentLayout.stop();
      }

      currentLayout = cy.layout({
        name: 'cose',
        animate: true,
        animationDuration: 1000,
        animationEasing: 'ease-out',
        nodeRepulsion: 12000,
        idealEdgeLength: 150,
        gravity: 0.2,
        randomize: true,
        nodeOverlap: 30,
        componentSpacing: 150,
        refresh: 20,
        fit: true,
        padding: 50
      });

      currentLayout.run();

      // After layout completes, center the summary node
      currentLayout.one('layoutstop', function() {
        const summaryNode = cy.getElementById('summary');
        if (summaryNode.length > 0) {
          cy.center(summaryNode);
          cy.zoom(0.9);
        }
      });
    }

    function showDetail(data) {
      const panel = document.getElementById('detailPanel');
      const title = document.getElementById('detailTitle');
      const content = document.getElementById('detailContent');
      const arabic = document.getElementById('detailArabic');
      const meta = document.getElementById('detailMeta');
      const links = document.getElementById('detailLinks');

      if (data.type === 'hadith') {
        title.textContent = 'Хадис';
        content.innerHTML = `<p>${data.fullText || data.label}</p>`;
        arabic.innerHTML = data.arabicText || '';

        meta.innerHTML = `
          <div class="meta-item">
            <span class="meta-label">Рассказчик:</span>
            <span>${data.narrator || 'Не указан'}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Коллекция:</span>
            <span>${data.collection ? data.collection.charAt(0).toUpperCase() + data.collection.slice(1) : 'Не указана'}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Книга:</span>
            <span>${data.book || 'Не указана'}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Номер:</span>
            <span>${data.number || 'Не указан'}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Достоверность:</span>
            <span>${data.grade || 'Не указана'}</span>
          </div>
        `;

        links.innerHTML = `
          <div class="meta-link">Показать иснад</div>
          <div class="meta-link">Подробный анализ</div>
          <div class="meta-link">Похожие хадисы</div>
          <div class="meta-link">Копировать ссылку</div>
        `;
      } else if (data.type === 'narrator') {
        title.textContent = 'Рассказчик';
        content.innerHTML = `<p>${data.label}</p><p style="margin-top:1rem;">Один из наиболее уважаемых передатчиков хадисов, известный своей точностью и надежностью в передаче слов Пророка Мухаммада (мир ему).</p>`;
        arabic.innerHTML = '';

        meta.innerHTML = `
          <div class="meta-item">
            <span class="meta-label">Период:</span>
            <span>7-8 век</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Количество хадисов:</span>
            <span>${Math.floor(Math.random() * 500) + 100}+</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Статус:</span>
            <span>Сподвижник</span>
          </div>
        `;

        links.innerHTML = `
          <div class="meta-link">Все хадисы рассказчика</div>
          <div class="meta-link">Биография</div>
          <div class="meta-link">Цепочки передачи</div>
        `;
      } else if (data.type === 'collection') {
        title.textContent = 'Коллекция хадисов';
        content.innerHTML = `<p>${data.label} - один из авторитетных сборников хадисов в исламской традиции, содержащий достоверные высказывания и действия Пророка Мухаммада (мир ему).</p>`;
        arabic.innerHTML = '';

        meta.innerHTML = `
          <div class="meta-item">
            <span class="meta-label">Составитель:</span>
            <span>${data.id === 'bukhari' ? 'Имам аль-Бухари' :
                   data.id === 'muslim' ? 'Имам Муслим' :
                   data.id === 'tirmidhi' ? 'Имам ат-Тирмизи' :
                   data.id === 'abudawud' ? 'Имам Абу Дауд' :
                   data.id === 'nasai' ? 'Имам ан-Насаи' :
                   'Имам Ибн Маджах'}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Период:</span>
            <span>9 век</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Количество хадисов:</span>
            <span>${Math.floor(Math.random() * 5000) + 2000}</span>
          </div>
        `;

        links.innerHTML = `
          <div class="meta-link">Обзор коллекции</div>
          <div class="meta-link">Особенности методологии</div>
          <div class="meta-link">Биография составителя</div>
        `;
      } else if (data.type === 'summary') {
        title.textContent = 'Обобщённый ответ';
        content.innerHTML = document.getElementById('summaryContent').innerHTML;
        arabic.innerHTML = '';

        meta.innerHTML = `
          <div class="meta-item">
            <span class="meta-label">Источников:</span>
            <span>${cy.nodes('[type="hadith"]').length}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Коллекций:</span>
            <span>${cy.nodes('[type="collection"]').length}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Рассказчиков:</span>
            <span>${cy.nodes('[type="narrator"]').length}</span>
          </div>
        `;

        links.innerHTML = `
          <div class="meta-link">Скачать в PDF</div>
          <div class="meta-link">Поделиться ответом</div>
          <div class="meta-link">Углубленный анализ</div>
        `;
      }

      panel.classList.add('active');
    }

    function closeDetail() {
      document.getElementById('detailPanel').classList.remove('active');
    }

    // Handle Enter key in search
    document.getElementById('query').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchHadith();
      }
    });

    // Initialize on load
    document.addEventListener('DOMContentLoaded', function() {
      initParticles();
      initGraph();
    });
  </script>
</body>
</html>
```